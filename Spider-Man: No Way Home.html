<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Moviecruise</title>
<link rel="stylesheet" href="./css/spiderman.css">
<script src="js/jquery-3.5.1.min.js"></script>
</head>
<body>

    <div id="header">
      <a href="./index.html">
      <img src="./img/titlelogo.png" alt="logo" width="11%" id="logo">
      </a>
      <div id="navigation-area">
        <ul id="navigation">
          <li class="navigation-double-margin">
            <a href="./index.html#movie">
              <span>æœ€æ–°æ³¨ç›®ä½œå“</span>
            </a>
          </li>
          <li class="navigation-double-margin">
            <a href="./index.html#news">
              <span>æ˜ ç”»ãƒ‹ãƒ¥ãƒ¼ã‚¹</span>
            </a>
          </li>
          <li class="navigation-double-margin">
            <a href="./index.html#theaters">
              <span>æ˜ ç”»é¤¨æƒ…å ±</span>
            </a>
          </li>
        </ul>
      </div>
   </div>

   <div id="movie1_container">
    <img src="./img/nowwayhome.jpeg" alt="" width="380px">
    <div class="movie_info">
      <p class="movie_title">ã‚¹ãƒ‘ã‚¤ãƒ€ãƒ¼ãƒãƒ³ï¼šãƒãƒ¼ãƒ»ã‚¦ã‚§ã‚¤ãƒ»ãƒ›ãƒ¼ãƒ ï¼ˆ2021å¹´)</p>
      <p>Spiderman: No way Home<br>ä¸Šæ˜ æ—¥ï¼š2022å¹´1æœˆ7æ—¥ã€€/ã€€è£½ä½œå›½ï¼šã‚¢ãƒ¡ãƒªã‚«ã€€/ã€€ä¸Šæ˜ æ™‚é–“ï¼š149åˆ†</p>
      <p class="bold">ç›£ç£ï¼šã‚¸ãƒ§ãƒ³ãƒ»ãƒ¯ãƒƒãƒ„ã€€ã€€å‡ºæ¼”ï¼šãƒˆãƒ ãƒ»ãƒ›ãƒ©ãƒ³ãƒ‰ã€ã‚¼ãƒ³ãƒ‡ã‚¤ãƒ¤ã€€ä»–</p>
      <p>å€’ã—ãŸæ•µã®æš´éœ²ã«ã‚ˆã‚Šã€ä¸–é–“ã‹ã‚‰æ‚ªè©•ã‚’å—ã‘ã‚‹ã‚¹ãƒ‘ã‚¤ãƒ€ãƒ¼ãƒãƒ³ã€‚è‡ªåˆ†ã®æ­£ä½“ãŒçŸ¥ã‚‰ã‚Œã¦ã„ãªã„ä¸–ç•Œã«æˆ»ã‚ŠãŸã„ã¨æ€ã†ã‚ˆã†ã«ãªã£ãŸå½¼ã¯ã€<br>å‹äººã®ãƒ‰ã‚¯ã‚¿ãƒ¼ãƒ»ã‚¹ãƒˆãƒ¬ãƒ³ã‚¸ã«åŠ©ã‘ã‚’æ±‚ã‚ã‚‹ã€‚ã‚„ãŒã¦é­”æ³•ã®åŠ›ã§ã€å½¼ã¯é•ã†ä¸–ç•Œç·šã§2ã¤ã®äººç”Ÿã‚’åŒæ™‚ã«æ­©ã¿å§‹ã‚ã‚‹ã€‚</p>
      <iframe width="560" height="315" src="https://www.youtube.com/embed/JfVOs4VSpmA" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen id="video"></iframe>
    </div>
  </div>

  <div class="title-container">
    <p class="title-text">ã€Œã‚¹ãƒ‘ã‚¤ãƒ€ãƒ¼ãƒãƒ³ï¼šãƒãƒ¼ãƒ»ã‚¦ã‚§ã‚¤ãƒ»ãƒ›ãƒ¼ãƒ ã€ã®æ„Ÿæƒ³ãƒ»è©•ä¾¡</p>
  </div>

<div id="inputcontainer">
<form action="">
  <table class="form-table">
    <tr>
      <th class="form-header">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </th>
      <td class="form-data">
        <input type="text" id="uname" class="form-text">
      </td>
    </tr>
    <tr>
      <th class="form-header">ã‚¿ã‚¤ãƒˆãƒ«</th>
      <td class="form-data">
        <input type="text" id="reviewtitle" class="form-text">
      </td>
    </tr>
    <tr>
      <th class="form-header">ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°<br></th>
      <td class="form-data">
        <div class="stars">
          <input id="star5" type="radio" name="star" value="5" />
          <label for="star5">â˜…</label>
          <input id="star4" type="radio" name="star" value="4" />
          <label for="star4">â˜…</label>
          <input id="star3" type="radio" name="star" value="3" />
          <label for="star3">â˜…</label>
          <input id="star2" type="radio" name="star" value="2" />
          <label for="star2">â˜…</label>
          <input id="star1" type="radio" name="star" value="1" />
          <label for="star1">â˜…</label>
        </div>
    </tr>
    <tr>
      <th class="form-header">ãƒ¬ãƒ“ãƒ¥ãƒ¼<br></th>
      <td class="form-data">
        <textarea id="text" class="form-longtext"></textarea>
      </td>
    </tr>
  </table>
</form>
  <p id="sendbutton"><button id="send">é€ä¿¡</button></p> 
</div>
    <div id="output"></div>
</div>

<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!-- JQuery -->


<!--** ä»¥ä¸‹Firebase **-->

<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.2/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries
  import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved }
        from "https://cdnjs.cloudflare.com/ajax/libs/firebase/9.6.2/firebase-database.min.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "",
    authDomain: "moviecruise-37ee6.firebaseapp.com",
    projectId: "moviecruise-37ee6",
    storageBucket: "moviecruise-37ee6.appspot.com",
    messagingSenderId: "788660871044",
    appId: "1:788660871044:web:f7add461ecca202d5d07d1"
  };
  
    // Initialize Firebase
    // firebaseã®è¨­å®šæƒ…å ±ã‚’ã€initializeappã«å…¥ã‚Œè¾¼ã‚“ã§ã„ã‚‹
    const app = initializeApp(firebaseConfig);

    const db = getDatabase(app); // RealtimeDBã«æ¥ç¶š
    const dbRef = ref(db, "review"); // RealtimeDBå†…ã®"review"ã‚’ä½¿ã†

        //ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã‚‰ç™ºå‹•
    $('input[name="star"]').change(function() {
        //é¸æŠã—ãŸvalueå€¤ã‚’å¤‰æ•°ã«æ ¼ç´
        var val = $(this).val();
        // if (val == 1) {
        //     let img = document.getElementById("star");
        //     img.src = "./imgs/stars1.png";
        // } else if (val == 2) {
        //     let img = document.getElementById("star");
        //     img.src = "./imgs/stars2.png";
        // } else if (val == 3){
        //     let img = document.getElementById("star");
        //     img.src = "./imgs/stars3.png";
        // } else if (val == 4){
        //     let img = document.getElementById("star");
        //     img.src = "./imgs/stars4.png";
        // } else if (val == 5){
        //     let img = document.getElementById("star");
        //     img.src = "./imgs/stars5.png";
        // }
        console.log(val);
    });

    $("#send").on("click", function(){
        const uname = $("#uname").val();
        const title = $("#reviewtitle").val();
        const text = $("#text").val();
        const rate = $('input:radio[name="star"]:checked').val();
        const msg = { //ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
            uname: uname,
            title: title,
            text: text,
            rate: rate
        }
        const newPostRef = push(dbRef); // pushã§ãã‚‹çŠ¶æ…‹ã«ã™ã‚‹(å‹ã‚’DBã«ä½œã‚‹)
        set(newPostRef, msg); // DBã«å€¤ã‚’é€ä¿¡
    });

    $("#text").on("keydown", function(e){
        if(e.keyCode === 13){
            const uname = $("#uname").val();
            const title = $("#reviewtitle").val();
            const text = $("#text").val();
            const rate = $('input:radio[name="star"]:checked').val();
            const msg = { //ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ
            uname: uname,
            title: title,
            text: text,
            rate: rate
        }
            const newPostRef = push(dbRef); // pushã§ãã‚‹çŠ¶æ…‹ã«ã™ã‚‹(å‹ã‚’DBã«ä½œã‚‹)
            set(newPostRef, msg); // DBã«å€¤ã‚’é€ä¿¡
        }
    });

    onChildAdded(dbRef, function(data){
        // onChildAddedã¯ãƒ‡ãƒ¼ã‚¿ã‚’ï¼‘ã¤ãšã¤â‘ ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸæ™‚ã«å–å¾—ã€â‘¡æ–°ã—ãä¿å­˜ã•ã‚ŒãŸã¨ãã«é€šçŸ¥ã¨ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã•ã‚Œã€dataã«æ ¼ç´ã•ã‚Œã‚‹
        const msg = data.val();
        const datakey = data.key;
        let h = `
        <div class='post'>
        <div class="flex">
        <p class='title'>${msg.title}</p>
        <img src="./img/star${msg.rate}.png" alt="" id="starrate">
        </div>
        <p class='nickname'>ğŸ‘¤ ${msg.uname}</p>
        <p class='review'>${msg.text}</p>
        <br><button class='delbutton' id=${datakey}>æŠ•ç¨¿ã‚’å‰Šé™¤</button>
        </div>`
        $("#output").append(h); // #output ã®æœ€å¾Œã«è¿½åŠ 
        $("#text").val("");
        $("#uname").val("");
        $("#reviewtitle").val("");
        $("input:radio[name='star']").prop("checked",false); //ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®ã‚¯ãƒªã‚¢
    });

    $(document).on("click",".delbutton",function(){ //documentã«ã‚ˆã£ã¦è¿½åŠ ã•ã‚ŒãŸHTMLã«å¯¾ã—ã¦é©ç”¨ã•ã‚Œã‚‹
    remove(ref(db, "review/" +$(this).attr("id"))); //thisã¯ãƒœã‚¿ãƒ³ã‚’æŒ‡ã™ã€idã¯ãƒœã‚¿ãƒ³ã®ID
    $(this).parent().remove();//ãƒœã‚¿ãƒ³ã®è¦ªè¦ç´ ã‚’å‰Šé™¤(parentãŒãªã„ã¨ã€ãƒœã‚¿ãƒ³ãŒæ¶ˆãˆã‚‹)
    });

  </script>

</body>
</html>
