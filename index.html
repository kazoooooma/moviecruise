<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Moviecruise</title>
<link rel="stylesheet" href="css/style.css">
<script src="js/jquery-3.5.1.min.js"></script>

</head>
<body>

    <div id="header">
      <a href="./index.html">
      <img src="./img/titlelogo.png" alt="logo" width="11%" id="logo">
      </a>
      <div id="navigation-area">
        <ul id="navigation">
          <li class="navigation-double-margin">
            <a href="#movie">
              <span>最新注目作品</span>
            </a>
          </li>
          <li class="navigation-double-margin">
            <a href="#news">
              <span>映画ニュース</span>
            </a>
          </li>
          <li class="navigation-double-margin">
            <a href="#theaters">
              <span>映画館情報</span>
            </a>
          </li>
        </ul>
      </div>
   </div>


<a name="movie">
<div class="title-container">
</a>
  <p class="title-text">最新注目作品</p>
</div>
   <header>
    <form id="form">
      <input type="text" placeholder="映画をタイトルで検索" size="50" id="search" class="search">
    </form>
  </header>
<main id="main">
  <div class="movie">
    <img src="" alt="">
    <div class="movie-info">
      <h3>Movie Title</h3>
      <span class="green">9.8</span>
    </div>
    <div class="overview">
      <h3>あらすじ</h3>
      あらすじ
    </div>
  </div>
</main>

<a name="news">
  <div id="news-container">
</a>
  <div class="title-container">
    <p class="title-text">最新映画ニュース</p>
  </div>
  <div id="article-container">
    <div id="wrap">
      <!-- <div class="txt-show"> -->
        <div id="article-area">
          <div id="article1"><a href="https://natalie.mu/eiga/news/460986">
            <div class="hover1">
              <img src="./img/newspic1.png" alt="ニュース画像" width="300px" height="200px">
              <p class="article-info-line">
                全米批評家協会賞「ドライブ・マイ・カー」が作品賞に、西島秀俊の主演男優賞はアジア人初
              </p>
              <p class="date">2022/1/9</p>
            </div></a>
          </div>
          <div id="article2"><a href="https://natalie.mu/eiga/news/460904">
            <div class="hover1">
              <img src="./img/newspic2.png" alt="ニュース画像" width="300px" height="200px">
              <p class="article-info-line">
                小谷忠典の長編劇映画「たまらん坂」3月に公開、渡邊雛子や古舘寛治ら出演
              </p>
              <p class="date">2022/1/9</p>
            </div></a>
          </div>
          <div id="article3">
            <div class="hover1"><a href="https://natalie.mu/eiga/news/460919">
              <img src="./img/newspic3.png" alt="ニュース画像" width="300px" height="200px">
              <p class="article-info-line">
                セーラー服の長澤まさみ！「コンフィデンスマンJP」特番が5夜連続放送
              </p>
              <p class="date">2022/1/8</p>
            </div></a>
          </div>
          <div id="article4">
            <div class="hover1"><a href="https://natalie.mu/eiga/news/460892">
              <img src="./img/newspic4.png" alt="ニュース画像" width="300px" height="200px">
              <p class="article-info-line">
                シドニー・ポワチエが94歳で死去、黒人として初めてアカデミー賞主演男優賞を受賞
              </p>
              <p class="date">2022/1/8</p>
            </div></a>
          </div>
        </div>
      <!-- </div> -->
      <p id="space"></p>
      <!-- <div class="txt-hide"> -->
        <div id="article-area2">
          <div id="article5">
            <div class="hover1"><a href="https://natalie.mu/eiga/news/460644">
              <img src="./img/newspic5.webp" alt="ニュース画像" width="300px" height="200px">
              <p class="article-info-line">
                ドニー・イェン×ニコラス・ツェーW主演作の拡大公開が決定、インタビュー映像到着
              </p>
              <p class="date">2022/1/7</p>
            </div></a>
          </div>
          <div id="article6">
            <div class="hover1"><a href="https://natalie.mu/eiga/news/460653">
              <img src="./img/newspic6.png" alt="ニュース画像" width="300px" height="200px">
              <p class="article-info-line">
                「ドクター・ストレンジMoM」全米より2日早い5月4日に公開決定
              </p>
              <p class="date">2022/1/7</p>
            </div></a>
          </div>
          <div id="article7">
            <div class="hover1"><a href="https://natalie.mu/eiga/news/460661"></a>
              <img src="./img/newspic7.png" alt="ニュース画像" width="300px" height="200px">
              <p class="article-info-line">
                皆が私を狙ってる…ケネス・ブラナー主演「ナイル殺人事件」本予告
              </p>
              <p class="date">2022/1/7</p>
            </div></a>
          </div>
          <div id="article8">
            <div class="hover1"><a href="https://natalie.mu/eiga/news/460686">
              <img src="./img/newspic8.png" alt="ニュース画像" width="300px" height="200px">
              <p class="article-info-line">
                ブルース・ウェインが謎解きに翻弄される「THE BATMAN」新映像
              </p>
              <p class="date">2022/1/7</p>
            </div></a>
          </div>
        </div>
      <!-- </div> -->
      <!-- <button class="more"></button> -->
      <a href="https://natalie.mu/eiga/news"><h3 id="morenews">>>ニュースをもっと見る</h3></a>
    </div>
  </div>
</div>

<a name="theaters">
  <div id="map-container">
</a>
  <div id="map-line-container">
    <p id="map-text">周辺の映画館情報</p>
  </div>
  <div id="myMap" style="position:relative;width:100%;height:450px;"></div>
</div>
    
</body>

<footer>
  <div id="footer">
  <p>copyright kazoooooma.inc No Rights Reserverd😎</p>
  </div>
</footer>

<!-- jQuery&GoogleMapsAPI -->
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<!-- /jQuery&GoogleMapsAPI -->

<!-- javascript -->
<script src="https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=" async defer></script>
<script>

// TMDB
const API_KEY = "api_key=";
const BASE_URL = "https://api.themoviedb.org/3";
const API_URL = BASE_URL + "/discover/movie?sort_by=popularity.desc&" + API_KEY + "&language=en-EN";
const IMG_URL = "https://image.tmdb.org/t/p/w500/";
const SEARCH_URL = BASE_URL + "/search/movie?" + API_KEY + "&language=en-EN";

const main = document.getElementById("main");
const form = document.getElementById("form");
const search = document.getElementById("search");

getmovies(API_URL);

function getmovies(url){
  fetch(url).then(res => res.json()).then(data => {
    console.log(data.results);
    showmovies(data.results);
  })
}

function showmovies(data){
  main.innerHTML = "";

  data.forEach(movie => {
    const {title, poster_path, vote_average, overview, id} = movie;
    const movieEl = document.createElement("div");
    movieEl.classList.add("movie");
    movieEl.innerHTML = `
    <a href="./${title}.html">
    <img src="${IMG_URL + poster_path}" alt="${title}">
    <div class="movie-info">
      <h3>${title}</h3>
      <span class=${getcolor(vote_average)}>${vote_average}</span>
    </div>
    <div class="overview">
      <h3>ストーリー</h3>
      ${overview}
    </div>
    </a>
    `  
    main.appendChild(movieEl);
  });
}

function getcolor(vote){
  if(vote >= 8){
    return "green"
  }else if(vote >= 5){
    return "orange"
  }else{
    return "red"
  }
  }

  form.addEventListener("submit" , (e) => {
    e.preventDefault();
    const searchTerm = search.value;
    if(searchTerm){
      getmovies(SEARCH_URL + "&query=" + searchTerm)
    }else{
      getmovies(API_URL)
    }
  })

  $(function(){
  $(".more").on("click", function() {
    $(this).toggleClass("on-click");
    $(".txt-hide").slideToggle(1000);
  });
}); 

let map;
function GetMap() {
        let map = new Microsoft.Maps.Map('#myMap', {
            center: new Microsoft.Maps.Location(35.6689603, 139.7030109),
            mapTypeId: Microsoft.Maps.MapTypeId.grayscale,
            zoom: 13, //Location center position
        });

        //Get MAP Infomation
        let center = map.getCenter();
      

        //Create custom Pushpin

        let tohoshinjuku = new Microsoft.Maps.Pushpin({latitude:35.69553727991968, longitude:139.70204377051388},{
          title: "TOHOシネマズ新宿",
          text:"",
          color: 'blue',            //Color
          enableClickedStyle:true, //Click
          enableHoverStyle:true,   //MouseOver
          visible:true             //show/hide
        });
        let tohohibiya = new Microsoft.Maps.Pushpin({latitude:35.67401477414013, longitude:139.75903773679065},{
          title: "TOHOシネマズ日比谷",
          text:"",
          color: 'blue',            //Color
          enableClickedStyle:true, //Click
          enableHoverStyle:true,   //MouseOver
          visible:true             //show/hide
        });
        let tohonihonbashi = new Microsoft.Maps.Pushpin({latitude:35.68705703459567, longitude:139.77484196877833},{
          title: "TOHOシネマズ日本橋",
          text:"",
          color: 'blue',            //Color
          enableClickedStyle:true, //Click
          enableHoverStyle:true,   //MouseOver
          visible:true             //show/hide
        });
        let tohoshibuya = new Microsoft.Maps.Pushpin({latitude:35.65927499228199, longitude:139.6988723822706},{
          title: "TOHOシネマズ渋谷",
          text:"",
          color: 'blue',            //Color
          enableClickedStyle:true, //Click
          enableHoverStyle:true,   //MouseOver
          visible:true             //show/hide
        });
        let tohoroppongi = new Microsoft.Maps.Pushpin({latitude:35.65992923924165, longitude:139.72946513994182},{
          title: "TOHOシネマズ六本木",
          text:"",
          color: 'blue',            //Color
          enableClickedStyle:true, //Click
          enableHoverStyle:true,   //MouseOver
          visible:true             //show/hide
        });
        let wald9 = new Microsoft.Maps.Pushpin({latitude:35.6903507832549, longitude:139.70588436877838},{
          title: "新宿バルト9",
          text:"",
          color: 'blue',            //Color
          enableClickedStyle:true, //Click
          enableHoverStyle:true,   //MouseOver
          visible:true             //show/hide
        });
        let piccadillymarunouchi = new Microsoft.Maps.Pushpin({latitude:35.675792376508745, longitude:139.76237110091677},{
          title: "丸の内ピカデリー",
          text:"",
          color: 'blue',            //Color
          enableClickedStyle:true, //Click
          enableHoverStyle:true,   //MouseOver
          visible:true             //show/hide
        });
        let piccadillyshinjuku = new Microsoft.Maps.Pushpin({latitude:35.692957621521, longitude:139.70369497644978},{
          title: "新宿ピカデリー",
          text:"",
          color: 'blue',            //Color
          enableClickedStyle:true, //Click
          enableHoverStyle:true,   //MouseOver
          visible:true             //show/hide
        });


        //Add the pushpin to the map
        map.entities.push(tohoshinjuku);
        map.entities.push(tohohibiya);
        map.entities.push(tohonihonbashi);
        map.entities.push(tohoshibuya);
        map.entities.push(tohoroppongi);
        map.entities.push(wald9);
        map.entities.push(piccadillymarunouchi);
        map.entities.push(piccadillyshinjuku);

        Microsoft.Maps.Events.addHandler(tohoshinjuku, "click", function(){location.href = "https://hlo.tohotheater.jp/net/schedule/076/TNPI2000J01.do"});
        Microsoft.Maps.Events.addHandler(tohohibiya, "click", function(){location.href = "https://hlo.tohotheater.jp/net/schedule/081/TNPI2000J01.do"});
        Microsoft.Maps.Events.addHandler(tohonihonbashi, "click", function(){location.href = "https://hlo.tohotheater.jp/net/schedule/073/TNPI2000J01.do"});
        Microsoft.Maps.Events.addHandler(tohoshibuya, "click", function(){location.href = "https://hlo.tohotheater.jp/net/schedule/043/TNPI2000J01.do"});
        Microsoft.Maps.Events.addHandler(tohoroppongi, "click", function(){location.href = "https://hlo.tohotheater.jp/net/schedule/009/TNPI2000J01.do"});
        Microsoft.Maps.Events.addHandler(wald9, "click", function(){location.href = "https://tjoy.jp/shinjuku_wald9"});
        Microsoft.Maps.Events.addHandler(piccadillymarunouchi, "click", function(){location.href = "https://www.smt-cinema.com/site/marunouchi/index.html"});
        Microsoft.Maps.Events.addHandler(piccadillyshinjuku, "click", function(){location.href = "https://www.smt-cinema.com/site/shinjuku/index.html"});
    }

//1．位置情報の取得に成功した時の処理
function mapsInit(position) {
  console.log(position)
    //lat=緯度、lon=経度 を取得
  const lat = position.coords.latitude;
  const lon = position.coords.longitude;
  // $("#view").text("緯度" + lat + "経度" + lon) 
  // テンプレートリテラルで書くなら
  // $("#view").text(`緯度${lat}経度${lon}`);
};

//2． 位置情報の取得に失敗した場合の処理
function mapsError(error) {
  let e = "";
  if (error.code == 1) { //1＝位置情報取得が許可されてない（ブラウザの設定）
    e = "位置情報が許可されてません";
  }
  if (error.code == 2) { //2＝現在地を特定できない
    e = "現在位置を特定できません";
  }
  if (error.code == 3) { //3＝位置情報を取得する前にタイムアウトになった場合
    e = "位置情報を取得する前にタイムアウトになりました";
  }
  alert("エラー：" + e);
};

//3.位置情報取得オプション
var set ={
  enableHighAccuracy: true, //より高精度な位置を求める
  maximumAge: 20000,        //最後の現在地情報取得が20秒以内であればその情報を再利用する設定
  timeout: 10000            //10秒以内に現在地情報を取得できなければ、処理を終了
};

//Main:位置情報を取得する処理 //getCurrentPosition :or: watchPosition
navigator.geolocation.getCurrentPosition(mapsInit, mapsError, set);

</script>
</body>

</html>